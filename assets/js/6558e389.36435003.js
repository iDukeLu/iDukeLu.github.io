"use strict";(self.webpackChunki_duke_lu_github_io=self.webpackChunki_duke_lu_github_io||[]).push([[5493],{1022:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>d,toc:()=>l});var o=t(5893),i=t(1151);const s={title:"\u8bbf\u95ee Redis\uff0c\u63d0\u793a\u8fdb\u5165\u4fdd\u62a4\u6a21\u5f0f",authors:"Duke Lu",date:new Date("2018-05-12T00:00:00.000Z"),tags:["redis"]},r=void 0,d={permalink:"/blog/2018/redis-protected-mode",source:"@site/blog/2018/redis-protected-mode.md",title:"\u8bbf\u95ee Redis\uff0c\u63d0\u793a\u8fdb\u5165\u4fdd\u62a4\u6a21\u5f0f",description:"\u95ee\u9898",date:"2018-05-12T00:00:00.000Z",formattedDate:"2018\u5e745\u670812\u65e5",tags:[{label:"redis",permalink:"/blog/tags/redis"}],readingTime:4.03,hasTruncateMarker:!1,authors:[{name:"Duke Lu",title:"Golang Development Engineer",url:"https://github.com/idukelu",imageURL:"https://github.com/idukelu.png",key:"Duke Lu"}],frontMatter:{title:"\u8bbf\u95ee Redis\uff0c\u63d0\u793a\u8fdb\u5165\u4fdd\u62a4\u6a21\u5f0f",authors:"Duke Lu",date:"2018-05-12T00:00:00.000Z",tags:["redis"]},unlisted:!1,prevItem:{title:"MySQL 8.0 \u5b89\u88c5\uff08CentOS 7\uff09",permalink:"/blog/2018/mysql-install-centos7"},nextItem:{title:"oh-my-zsh \u62a5\u9519\uff1a\u63d0\u793a\u68c0\u6d4b\u5230\u4e0d\u5b89\u5168\u7684\u5b8c\u6210\u76f8\u5173\u76ee\u5f55",permalink:"/blog/2018/oh-my-zsh-unsafe"}},c={authorsImageUrls:[void 0]},l=[{value:"\u95ee\u9898",id:"\u95ee\u9898",level:2},{value:"\u89e3\u51b3",id:"\u89e3\u51b3",level:2}];function a(e){const n={blockquote:"blockquote",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"\u95ee\u9898",children:"\u95ee\u9898"}),"\n",(0,o.jsx)(n.p,{children:"Redis protected-mode \u662f3.2 \u4e4b\u540e\u52a0\u5165\u7684\u65b0\u7279\u6027\uff0c\u901a\u8fc7\u53c2\u8003\u914d\u7f6e\u6587\u4ef6\u4e0a\u7684\u8bf4\u660e\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'# When protected mode is on and if:\n# 1) The server is not binding explicitly to a set of addresses using the "bind" directive.\n# 2) No password is configured.\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u53ef\u4ee5\u77e5\u9053\uff0c\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\u4f1a\u5f00\u542f\u4fdd\u62a4\u6a21\u5f0f\uff1a"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"\u670d\u52a1\u5668\u6ca1\u6709\u4f7f\u7528\u201cbind\u201d\u6307\u4ee4\u663e\u5f0f\u7ed1\u5b9a\u5230\u4e00\u7ec4\u5730\u5740"}),"\n",(0,o.jsx)(n.li,{children:"\u6ca1\u6709\u914d\u7f6e\u5bc6\u7801"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"\u4ece\u800c\u4e0d\u80fd\u8fdb\u884c\u8fdc\u7a0b\u8fde\u63a5\uff0c\u5426\u5219\u5c31\u4f1a\u6709\u4ee5\u4e0b\u63d0\u793a\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"-DENIED Redis is running in protected mode because protected mode is enabled, no bind address was specified, no authentication password is requested to clients. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: 1) Just disable protected mode sending the command 'CONFIG SET protected-mode no' from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. 2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to 'no', and then restarting the server. 3) If you started the server manually just for testing, restart it with the '--protected-mode no' option. 4) Setup a bind address or an authentication password. NOTE: You only need to do one of the above things in order for the server to start accepting connections from the outside.\nConnection closed by foreign host.\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u89e3\u51b3",children:"\u89e3\u51b3"}),"\n",(0,o.jsx)(n.p,{children:"\u5728\u95ee\u9898\u63cf\u8ff0\u4e2d\uff0c\u5df2\u7ecf\u7ed9\u51fa\u4e86\u76f8\u5e94\u7684\u89e3\u51b3\u65b9\u6848"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"1) Just disable protected mode sending the command 'CONFIG SET protected-mode no' from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. \n2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to 'no', and then restarting the server. \n3) If you started the server manually just for testing, restart it with the '--protected-mode no' option. \n4) Setup a bind address or an authentication password. \nNOTE: You only need to do one of the above things in order for the server to start accepting connections from the outside\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\u53d1\u9001\u547d\u4ee4 ",(0,o.jsx)(n.code,{children:"CONFIG SET protected-mode no"})," \uff0c\u8fd9\u79cd\u8bbe\u7f6e\u4e0d\u662f\u6c38\u4e45\u7684\uff0c\u4f46\u53ef\u4ee5\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u4f7f\u4e4b\u6c38\u4e45\u751f\u6548"]}),"\n",(0,o.jsxs)(n.li,{children:["\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 ",(0,o.jsx)(n.code,{children:"/etc/redis.conf"})," \uff0c\u5c06 ",(0,o.jsx)(n.code,{children:"protected-mode yes"})," \u8bbe\u7f6e\u4e3a ",(0,o.jsx)(n.code,{children:"no"})]}),"\n",(0,o.jsxs)(n.li,{children:["\u542f\u52a8\u65f6\u6dfb\u52a0\u9009\u9879 ",(0,o.jsx)(n.code,{children:"--protected-mode no"})]}),"\n",(0,o.jsx)(n.li,{children:"\u7ed1\u5b9a\u5730\u5740\u6216\u8005\u8bbe\u7f6e\u8ba4\u8bc1\u5bc6\u7801\n\u6ce8\u610f\uff1a\u60a8\u53ea\u9700\u8981\u6267\u884c\u4e0a\u8ff0\u64cd\u4f5c\u4e4b\u4e00\uff0c\u670d\u52a1\u5668\u5c31\u53ef\u4ee5\u5f00\u59cb\u63a5\u53d7\u6765\u81ea\u5916\u90e8\u7684\u8fde\u63a5"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"\u5176\u5b9e\u6709\u7528\u7684\u5c31 2 \u548c 4 \u4e24\u79cd\u65b9\u5f0f\uff1a"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 ",(0,o.jsx)(n.code,{children:"/etc/redis.conf"})," \uff0c\u5c06 ",(0,o.jsx)(n.code,{children:"protected-mode yes"})," \u8bbe\u7f6e\u4e3a ",(0,o.jsx)(n.code,{children:"no"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"protected-mode no\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u6ce8\u610f\uff1a\u5173\u95ed\u4fdd\u62a4\u6a21\u5f0f\u540e\uff0c\u540c\u65f6\u53c8\u8bbe\u7f6e\u4e86\u7ed1\u5b9a\u5730\u5740\u6216\u8005\u8ba4\u8bc1\u5bc6\u7801\uff0c\u4ecd\u9700\u6ee1\u8db3\u7ed1\u5b9a\u5730\u5740\u548c\u8ba4\u8bc1\u5bc6\u7801\u7684\u6761\u4ef6\uff0c\u624d\u80fd\u8bbf\u95ee redis \u670d\u52a1"}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u7ed1\u5b9a\u5730\u5740\u6216\u8005\u8bbe\u7f6e\u8ba4\u8bc1\u5bc6\u7801"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u7ed1\u5b9a\u5730\u5740\uff1a\u4e0d\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u5747\u53ef\u8bbf\u95ee"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"# bind \u53ef\u7ed1\u5b9a\u591a\u4e2a\u4e3b\u673a\u5730\u5740\uff0c\u7c7b\u4f3c\u8fc7\u6ee4\u5668\u7684\u4f5c\u7528\n# \u5f53\u914d\u7f6e\u4e3a 0.0.0.0 \u65f6\uff0c\u5141\u8bb8\u4efb\u4f55\u4e3b\u673a\u8bbf\u95ee\nbind 127.0.0.1 # \u5141\u8bb8\u672c\u673a\u8bbf\u95ee\nbind 45.123.77.99 # \u5141\u8bb8 45.123.77.99 \u7684\u4e3b\u673a\u8bbf\u95ee\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u8bbe\u7f6e\u8ba4\u8bc1\u5bc6\u7801"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"# \u5b98\u65b9\u63d0\u793a\uff1a\u5bc6\u7801\u5e94\u8be5\u8db3\u591f\u5f3a\u58ee\uff0c\u4e0d\u7136\u5f88\u5bb9\u6613\u88ab\u7834\u89e3\n# \u539f\u56e0\u662f\uff1asince Redis is pretty fast -- Redis \u975e\u5e38\u5feb\uff0c\u53ef\u4ee5\u4ee5 150k\u6b21/s \u7684\u901f\u5ea6\u8fdb\u884c\u7834\u89e3\nrequirepass idukelu\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"\u6ce8\u610f\uff1a\u5373\u7ed1\u5b9a\u4e86\u5730\u5740\uff0c\u53c8\u8bbe\u7f6e\u4e86\u8ba4\u8bc1\u5bc6\u7801\uff0c\u9700\u8981\u6ee1\u8db3\u4e24\u8005\u624d\u80fd\u8bbf\u95ee redis \u670d\u52a1"})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>d,a:()=>r});var o=t(7294);const i={},s=o.createContext(i);function r(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);