# plane-euthymia
基于 Docusaurus 搭建的静态文档站。

## 搭建流程
1. 初始化文档站。
```
npx create-docusaurus@latest <文件夹> classic
```

2. 在根目录（odocs 目录），安装依赖。
```
yarn
```

3. 删除原有模版的演示目录。
```
rm -rf ./blog
rm -rf ./docs
```


4. 创建边栏文件夹。我们这里将 *./docs/{module_dir}* 目录作为一个的边栏，进而隔离各个模块的文档。
```
## 创建服务管理模块的文件夹
mkdir -p ./docs/service-management

## 创建监控告警模块的文件夹
mkdir -p ./docs/monitoring
```

5. 修改边栏配置文件 *sidebars.js*
```
const sidebars = {
  // 声明一个边栏，如 serviceManagementSidebar，并配置边栏的一些属性：
  //   - type：边栏类型。配置为 autogenerated 时将自动根据文件夹下的 md 文件生成边栏目录。
  //   - dirName：边栏对应的文件夹目录。默认读取 *./docs* 目录，即配置 *dirName: 'monitoring'* 读取目录为 *./docs/monitoring*
  serviceManagementSidebar: [{type: 'autogenerated', dirName: 'service-management'}],
  monitoringSidebar: [{type: 'autogenerated', dirName: 'monitoring'}],
};
```

6. 修改站点配置文件 *docusaurus.config.js*，使刚刚配置的边栏生效
```
themeConfig:
    /** @type {import('@docusaurus/preset-classic').ThemeConfig} */
    ({
      image: 'img/docusaurus-social-card.jpg',
      navbar: {
        ...
        items: [
          {
            type: 'dropdown',
            label: '服务治理',
            position: 'left',
            items: [
              {
                type: 'docSidebar',
                sidebarId: 'serviceManagementSidebar', // 在 sidebars.js 声明的边栏
                label: '服务管理',                      // 页面上展示的名称
              },
              {
                type: 'docSidebar',
                sidebarId: 'monitoringSidebar',
                label: '监控告警',
              }
            ],
          },
          ...
        ],
      },
      ...
    }),
```

7. 本地调试
```
yarn start
```

## 添加插件
### 搜索插件
使用支持中文搜索的插件：https://github.com/easyops-cn/docusaurus-search-local

1. 安装搜索插件
```
npm install --save @easyops-cn/docusaurus-search-local
# or
yarn add @easyops-cn/docusaurus-search-local
```

2. 配置搜索插件
```
// In your `docusaurus.config.js`:
module.exports = {
  // ... Your other configurations.
  themes: [
    // ... Your other themes.
    [
      require.resolve("@easyops-cn/docusaurus-search-local"),
      /** @type {import("@easyops-cn/docusaurus-search-local").PluginOptions} */
      ({
        // ... Your options.
        // `hashed` is recommended as long-term-cache of index file is possible.
        hashed: true,
        // For Docs using Chinese, The `language` is recommended to set to:
        // ```
        // language: ["en", "zh"],
        // ```
      }),
    ],
  ],
};
```

### 图片变焦插件
1. 安装变焦插件
```
npm install docusaurus-plugin-image-zoom
# or
yarn add docusaurus-plugin-image-zoom
```

2. 配置变焦插件
```
plugins: [
    require.resolve('docusaurus-plugin-image-zoom')
  ],
```
详细参考：https://www.npmjs.com/package/docusaurus-plugin-image-zoom

## 部署 GitHub Pages

### 部署配置
**修改 *docusaurus.config.js* 配置**
```
module.exports = {
  // ...
  url: 'https://idukelu.github.io',  // Your website URL
  baseUrl: '/plane-euthymia',        // For GitHub pages deployment, it is often '/<projectName>/'
  organizationName: 'iDukeLu',       // Usually your GitHub org/user name.
  projectName: 'plane-euthymia',     // Usually your repo name.
  trailingSlash: true,
  // ...
};
```
更多可参考：https://docusaurus.io/zh-CN/docs/deployment#docusaurusconfigjs-settings

**使用自定义域名**
1. 在 static 目录下添加 CNAME 文件
```
cat > ./static/CNAME << EOF
idukelu.com
EOF
```

2. 根据官方文档说明修改 *docusaurus.config.js* 配置
> When using a custom domain, you should be able to move back from baseUrl: '/projectName/' to baseUrl: '/', and also set your url to your custom domain.
```
module.exports = {
  // ...
  url: 'https://idukelu.com',  // Your website URL
  baseUrl: '/',        // For GitHub pages deployment, it is often '/<projectName>/'
  organizationName: 'iDukeLu',       // Usually your GitHub org/user name.
  projectName: 'plane-euthymia',     // Usually your repo name.
  trailingSlash: true,
  // ...
};
```
更多可参考：https://docusaurus.io/zh-CN/docs/deployment#github-pages-overview

### 部署命令
1. 使用 SSH 进行部署，避免每次都输密码
```
GIT_USER=idukelu USE_SSH=true yarn deploy
```
其他环境参数可参考：https://docusaurus.io/zh-CN/docs/deployment#environment-settings

2. 为了方便使用，可以在 *package.json* 中添加对应的脚本命令
```
 "scripts": {
    ...
    "deploy": "docusaurus deploy",
    "gh-deploy": "GIT_USER=idukelu USE_SSH=true docusaurus deploy",
    ...
  },
```